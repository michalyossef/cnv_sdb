# Configurator

Create and consume environment specific configs. For node.js and browser consumption.

Solves the problem of having different configurations in different environment.
Common examples are server connections and ports.

Allows a "default" config with the ability to override or create new values on a per environment basis.

## Installation

```sh
npm install configurator
```

If you are using AngularJS (version < 2.x):

```shell
bower install --save configurator
```

## Usage

Typical usage includes one or more calls to ```register``` followed by
accessing the ```config``` property to retrieve what was set.

When passing in config objects to ```register``` a 'NODE_ENV' key will be expected in the case of node.js installs and
a 'HOST' key will be expected in the case of browser execution.

### Examples

#### browser - angular example

app/index.html

```html
    <script src="bower_components/configurator/dist/configurator.js"></script>
```

app/scripts/app.js

```javascript
angular.module('myApp', [
    // add 'intcConfigurator' to other module dependencies
    'intcConfigurator'
])
    // when inside the angular .config block you must refer to the long name intcConfiguratorProvider
    .config(function (intcConfiguratorProvider) {
        var configurator = intcConfiguratorProvider;

        // default value
        configurator.register({
            serviceRoot: 'http://defaultService.intel.com',
            githubApiRoot: 'https://github.intel.com/api/v3'
        });
        // for local dev
        configurator.register({
            HOST: '127.0.0.1:9000',
            serviceRoot: 'http://localhost:1337'
        });
        // production values
        configurator.register({
            HOST: 'myapp.intel.com',
            serviceRoot: 'http://myservice.intel.com'
        });
    })
    .config(function ($routeProvider) {
```

app/scripts/controllers/main.js

```javascript
angular.module('myApp')
    // when inside controller you must refer to the short name intcConfigurator
    .controller('MainCtrl', function ($scope, intcConfigurator) {
        var config = intcConfigurator.config;
        // config object returns value based on host in the location bar.
        // if current host does not match a registered HOST the default value will be used.
        console.log('service root:', config.serviceRoot);
    });
```

#### node.js example

configurator.config.js

```javascript
var configurator = require('configurator');

configurator.register(
    {
        serviceType: 'rest'
    }
);
configurator.register(
    {
        NODE_ENV: 'development',
        serviceRoot: 'http://myservice-dev.intel.com',
        developer: 'drpresto'
    }
);
configurator.register(
    {
        NODE_ENV: 'production',
        serviceRoot: 'http://myservice.intel.com'
    }
);

module.exports = configurator.config;

// run from production:
// returns
// {
//   serviceType: 'rest,
//   NODE_ENV: 'production',
//   serviceRoot: 'http://myservice.intel.com'
// }
```

#### browser - requirejs example

configurator.config.js

```javascript
define(['/vendor/configurator/configurator.js'], function(configurator) {
    configurator.register(
        {
            HOST: 'localhost:8000',
            serviceRoot: 'http://myservice-dev.intel.com'
        }
    );
    configurator.register(
        {
            HOST: 'myapp.intel.com',
            serviceRoot: 'http://myservice.intel.com'
        }
    );
    return Configurator.config;
});
```

### browser - old school example

HTML

```html
<script src="/vendor/configurator/configurator.js"></script>
<script src="someother.js"></script>
```

js (someother.js)

```javascript
// notice the capital C in Configurator
// of course it would be possible to say var configurator = Configurator so that all the examples would be the same.
Configurator.register([
    {
        HOST: 'localhost:8000',
        serviceRoot: 'http://myservice-dev.intel.com'
    },
    {
        HOST: 'myapp.intel.com',
        serviceRoot: 'http://myservice.intel.com'
    }
]);
Configurator.config.serviceRoot // => 'http://myservice.intel.com'
```

Note: ```register``` will optionally take an array instead of an object. This is demonstrated in the "old school" example.
In that way you can make multiple register calls with a single execution.

## Customization

If you don't like the default behavior for naming the current environment,
or if you have special needs for identifying the current environment there are
two main ways of customizing configurator (short of forking or badgering me into modifying the defaults).

1. `configurator.getTargetEnvironment` - function that takes an object representing your configurations and extracts the targeted
   environment as a string.
1. `configurator.getCurrentEnvironment` - function that returns a string matching one of the targeted environments in your configs

```javascript
// Example of overriding the process to identify the targeted environment.
configurator.getTargetEnvironment = function(config) {
    // overrides default behavior which looks for a NODE_ENV key.
    if (configs.environment) {
        return String(configs.environment).toLowerCase();
    }
    else {
        return 'default';
    }
}

// Example of overriding the process to identify the current environment.
configurator.getCurrentEnvironment = function() {
    // overrides default behavior which uses the NODE_ENV environment variable
    return process.env.ENVIRONMENT.toLowerCase();
}

// Example of overriding the process to identify the current environment.
configurator.getCurrentEnvironment = function() {
    // overrides default behavior in browser which uses a simple location.host
    // this example "lifted" from brandon's https://github.intel.com/5Star/intcNg/blob/master/services/environment.js
    var host = $location.host();
    host = host.toLowerCase();
    if (list) {
        env = _.find(list, function(environment) {
            var bar = environment.appUrl.toLowerCase() == host || '127.0.0.1';
            return bar;
        });
    }
    return env;
}
```

Note: ```getTargetEnvironment``` is used internally during register calls, so if you want to override it you
must do so before making register calls.

## Run Tests

1. mocha should be installed globally
1. ```npm install``` to grab dependencies like chai for testing.

```shell
npm test
```
